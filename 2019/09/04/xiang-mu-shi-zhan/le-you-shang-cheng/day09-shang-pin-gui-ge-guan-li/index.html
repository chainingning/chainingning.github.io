<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="day09-商品规格管理, 柴米油盐, Chester">
    <meta name="description" content="0.学习目标
了解商品规格数据结构设计思路
实现商品规格查询
了解SPU和SKU数据结构设计思路
实现商品查询
了解商品新增的页面实现
独立编写商品新增后台功能

1.商品规格数据结构乐优商城是一个全品类的电商网站，因此商品的种类繁多，每一">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>day09-商品规格管理 | 柴米油盐</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
        code[class*="language-"], pre[class*="language-"] {
            white-space: pre !important;
        }
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<link rel="stylesheet" href="/chaining/css/prism-tomorrow.css" type="text/css"></head>


<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/chaining/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">柴米油盐</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/photo" class="waves-effect waves-light">
            
            <i class="fa fa-camera-retro"></i>
            
            <span>相册</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">柴米油盐</div>
        <div class="logo-desc">
            
            也许,我们能在柴米油盐的生活中做的更好一些。
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/photo" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-camera-retro"></i>
                
                相册
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/chainingning" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/chainingning" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>





<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/0.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        day09-商品规格管理
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }
</style>
<div class="row">
    <div class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/chaining/tags/SpringBoot/" target="_blank">
                                <span class="chip bg-color">SpringBoot</span>
                            </a>
                        
                            <a href="/chaining/tags/项目实战/" target="_blank">
                                <span class="chip bg-color">项目实战</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/chaining/categories/项目实战/" class="post-category" target="_blank">
                                项目实战
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2019-09-04
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                        5.8k
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                        23 分
                    </div>
                    
                
				
				
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="0-学习目标"><a href="#0-学习目标" class="headerlink" title="0.学习目标"></a>0.学习目标</h1><ul>
<li>了解商品规格数据结构设计思路</li>
<li>实现商品规格查询</li>
<li>了解SPU和SKU数据结构设计思路</li>
<li>实现商品查询</li>
<li>了解商品新增的页面实现</li>
<li>独立编写商品新增后台功能</li>
</ul>
<h1 id="1-商品规格数据结构"><a href="#1-商品规格数据结构" class="headerlink" title="1.商品规格数据结构"></a>1.商品规格数据结构</h1><p>乐优商城是一个全品类的电商网站，因此商品的种类繁多，每一件商品，其属性又有差别。为了更准确描述商品及细分差别，抽象出两个概念：SPU和SKU，了解一下：</p>
<h2 id="1-1-SPU和SKU"><a href="#1-1-SPU和SKU" class="headerlink" title="1.1.SPU和SKU"></a>1.1.SPU和SKU</h2><p>SPU：Standard Product Unit （标准产品单位） ，一组具有共同属性的商品集</p>
<p>SKU：Stock Keeping Unit（库存量单位），SPU商品集因具体特性不同而细分的每个商品</p>
<p>以图为例来看：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1526085541996.png" alt="1526085541996"></p>
<ul>
<li>本页的 华为Mate10 就是一个商品集（SPU）</li>
<li>因为颜色、内存等不同，而细分出不同的Mate10，如亮黑色128G版。（SKU）</li>
</ul>
<p>可以看出：</p>
<ul>
<li>SPU是一个抽象的商品集概念，为了方便后台的管理。</li>
<li>SKU才是具体要销售的商品，每一个SKU的价格、库存可能会不一样，用户购买的是SKU而不是SPU</li>
</ul>
<h2 id="1-2-数据库设计分析"><a href="#1-2-数据库设计分析" class="headerlink" title="1.2.数据库设计分析"></a>1.2.数据库设计分析</h2><h3 id="1-2-1-思考并发现问题"><a href="#1-2-1-思考并发现问题" class="headerlink" title="1.2.1.思考并发现问题"></a>1.2.1.思考并发现问题</h3><p>弄清楚了SPU和SKU的概念区分，接下来我们一起思考一下该如何设计数据库表。</p>
<p>首先来看SPU，大家一起思考下SPU应该有哪些字段来描述？</p>
<pre><code>id:主键
title：标题
description：描述
specification：规格
packaging_list：包装
after_service：售后服务
comment：评价
category_id：商品分类
brand_id：品牌</code></pre><p>似乎并不复杂，但是大家仔细思考一下，商品的规格字段你如何填写？</p>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1526086539789.png" alt="1526086539789"></p>
<p>不同商品的规格不一定相同，数据库中要如何保存？</p>
<p>再看下SKU，大家觉得应该有什么字段？</p>
<pre><code>id：主键
spu_id：关联的spu
price：价格
images：图片
stock：库存
颜色？
内存？
硬盘？</code></pre><p>碰到难题了，不同的商品分类，可能属性是不一样的，比如手机有内存，衣服有尺码，我们是全品类的电商网站，这些不同的商品的不同属性，如何设计到一张表中？</p>
<p>其实颜色、内存、硬盘属性都是规格参数中的字段。所以，要解决这个问题，首先要能清楚规格参数。</p>
<h3 id="1-2-2-分析规格参数"><a href="#1-2-2-分析规格参数" class="headerlink" title="1.2.2.分析规格参数"></a>1.2.2.分析规格参数</h3><p>仔细查看每一种商品的规格你会发现：</p>
<p>虽然商品规格千变万化，但是同一类商品（如手机）的规格是统一的，有图为证：</p>
<blockquote>
<p>华为的规格：</p>
</blockquote>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1526087063700.png" alt="1526087063700"></p>
<blockquote>
<p>三星的规格：</p>
</blockquote>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1526087142454.png" alt="1526087142454"></p>
<h3 id="1-2-3-SKU的特有属性"><a href="#1-2-3-SKU的特有属性" class="headerlink" title="1.2.3.SKU的特有属性"></a>1.2.3.SKU的特有属性</h3><p>SPU中会有一些特殊属性，用来区分不同的SKU，我们称为SKU特有属性。如华为META10的颜色、内存属性。</p>
<p>不同种类的商品，一个手机，一个衣服，其SKU属性不相同。</p>
<p>同一种类的商品，比如都是衣服，SKU属性基本是一样的，都是颜色、尺码等。</p>
<p>这样说起来，似乎SKU的特有属性也是与分类相关的？事实上，仔细观察你会发现，<strong>SKU的特有属性是商品规格参数的一部分</strong>：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1526088981953.png" alt="1526088981953"></p>
<p>也就是说，我们没必要单独对SKU的特有属性进行设计，它可以看做是规格参数中的一部分。这样规格参数中的属性可以标记成两部分：</p>
<ul>
<li>spu下所有sku共享的规格属性（称为全局属性）</li>
<li>每个sku不同的规格属性（称为特有属性）</li>
</ul>
<h3 id="1-2-4-搜索属性"><a href="#1-2-4-搜索属性" class="headerlink" title="1.2.4.搜索属性"></a>1.2.4.搜索属性</h3><p>打开一个搜索页，我们来看看过滤的条件：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1526090072535.png" alt="1526090072535"></p>
<p>你会发现，过滤条件中的屏幕尺寸、运行内存、网路、机身内存、电池容量、CPU核数等，在规格参数中都能找到：</p>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1526090228171.png" alt="1526090228171"></p>
<p>也就是说，规格参数中的数据，将来会有一部分作为搜索条件来使用。我们可以在设计时，将这部分属性标记出来，将来做搜索的时候，作为过滤条件。要注意的是，无论是SPU的全局属性，还是SKU的特有属性，都有可能作为搜索过滤条件的，并不冲突，而是有一个交集：</p>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1526091216124.png" alt="1526091216124"></p>
<h2 id="1-3-规格参数表"><a href="#1-3-规格参数表" class="headerlink" title="1.3.规格参数表"></a>1.3.规格参数表</h2><h3 id="1-3-1-表结构"><a href="#1-3-1-表结构" class="headerlink" title="1.3.1.表结构"></a>1.3.1.表结构</h3><p>我们看下规格参数的格式：</p>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1526092179381.png" alt="1526092179381"></p>
<p>可以看到规格参数是分组的，每一组都有多个参数键值对。不过对于规格参数的模板而言，其值现在是不确定的，不同的商品值肯定不同，模板中只要保存组信息、组内参数信息即可。</p>
<p>因此我们设计了两张表：</p>
<ul>
<li>tb_spec_group：组，与商品分类关联</li>
<li>tb_spec_param：参数名，与组关联，一对多</li>
</ul>
<h3 id="1-3-2-规格组"><a href="#1-3-2-规格组" class="headerlink" title="1.3.2.规格组"></a>1.3.2.规格组</h3><p>规格参数分组表：tb_spec_group</p>
<pre class=" language-mysql"><code class="language-mysql">CREATE TABLE `tb_spec_group` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `cid` bigint(20) NOT NULL COMMENT '商品分类id，一个分类下有多个规格组',
  `name` varchar(50) NOT NULL COMMENT '规格组的名称',
  PRIMARY KEY (`id`),
  KEY `key_category` (`cid`)
) ENGINE=InnoDB AUTO_INCREMENT=14 DEFAULT CHARSET=utf8 COMMENT='规格参数的分组表，每个商品分类下有多个规格参数组';</code></pre>
<p>规格组有3个字段：</p>
<ul>
<li>id：主键</li>
<li>cid：商品分类id，一个分类下有多个模板</li>
<li>name：该规格组的名称。</li>
</ul>
<h3 id="1-3-2-规格参数"><a href="#1-3-2-规格参数" class="headerlink" title="1.3.2.规格参数"></a>1.3.2.规格参数</h3><p>规格参数表：tb_spec_param</p>
<pre class=" language-mysql"><code class="language-mysql">CREATE TABLE `tb_spec_param` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `cid` bigint(20) NOT NULL COMMENT '商品分类id',
  `group_id` bigint(20) NOT NULL,
  `name` varchar(255) NOT NULL COMMENT '参数名',
  `numeric` tinyint(1) NOT NULL COMMENT '是否是数字类型参数，true或false',
  `unit` varchar(255) DEFAULT '' COMMENT '数字类型参数的单位，非数字类型可以为空',
  `generic` tinyint(1) NOT NULL COMMENT '是否是sku通用属性，true或false',
  `searching` tinyint(1) NOT NULL COMMENT '是否用于搜索过滤，true或false',
  `segments` varchar(1000) DEFAULT '' COMMENT '数值类型参数，如果需要搜索，则添加分段间隔值，如CPU频率间隔：0.5-1.0',
  PRIMARY KEY (`id`),
  KEY `key_group` (`group_id`),
  KEY `key_category` (`cid`)
) ENGINE=InnoDB AUTO_INCREMENT=24 DEFAULT CHARSET=utf8 COMMENT='规格参数组下的参数名';</code></pre>
<p>按道理来说，我们的规格参数就只需要记录参数名、组id、商品分类id即可。但是这里却多出了很多字段，为什么？</p>
<p>还记得我们之前的分析吧，规格参数中有一部分是 SKU的通用属性，一部分是SKU的特有属性，而且其中会有一些将来用作搜索过滤，这些信息都需要标记出来。</p>
<blockquote>
<p>通用属性</p>
</blockquote>
<p>用一个布尔类型字段来标记是否为通用：</p>
<ul>
<li>generic来标记是否为通用属性：<ul>
<li>true：代表通用属性</li>
<li>false：代表sku特有属性</li>
</ul>
</li>
</ul>
<blockquote>
<p>搜索过滤</p>
</blockquote>
<p>与搜索相关的有两个字段：</p>
<ul>
<li>searching：标记是否用作过滤<ul>
<li>true：用于过滤搜索</li>
<li>false：不用于过滤</li>
</ul>
</li>
<li>segments：某些数值类型的参数，在搜索时需要按区间划分，这里提前确定好划分区间<ul>
<li>比如电池容量，0<del>2000mAh，2000mAh</del>3000mAh，3000mAh~4000mAh</li>
</ul>
</li>
</ul>
<blockquote>
<p>数值类型</p>
</blockquote>
<p>某些规格参数可能为数值类型，这样的数据才需要划分区间，我们有两个字段来描述：</p>
<ul>
<li>numberic：是否为数值类型<ul>
<li>true：数值类型</li>
<li>false：不是数值类型</li>
</ul>
</li>
<li>unit：参数的单位</li>
</ul>
<h1 id="2-商品规格参数管理"><a href="#2-商品规格参数管理" class="headerlink" title="2.商品规格参数管理"></a>2.商品规格参数管理</h1><h2 id="2-1-页面布局"><a href="#2-1-页面布局" class="headerlink" title="2.1.页面布局"></a>2.1.页面布局</h2><h3 id="2-1-1-整体布局"><a href="#2-1-1-整体布局" class="headerlink" title="2.1.1.整体布局"></a>2.1.1.整体布局</h3><p>打开规格参数页面，看到如下内容：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1529549099049.png" alt="1529549099049"></p>
<p>商品分类树我们之前已经做过，所以这里可以直接展示出来。</p>
<p>因为规格是跟商品分类绑定的，因此首先会展现商品分类树，并且提示你要选择商品分类，才能看到规格参数的模板。一起了解下页面的实现：</p>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1529549521623.png" alt="1529549521623"></p>
<p>页面结构：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528423299102.png" alt="1528423299102"></p>
<p>这里使用了<code>v-layout</code>来完成页面布局，并且添加了row属性，代表接下来的内容是行布局（左右）。</p>
<p>可以看出页面分成2个部分：</p>
<ul>
<li><code>&lt;v-flex xs3&gt;</code>：左侧，内部又分上下两部分：商品分类树及标题<ul>
<li><code>v-card-title</code>：标题部分，这里是提示信息，告诉用户要先选择分类，才能看到模板</li>
<li><code>v-tree</code>：这里用到的是我们之前讲过的树组件，展示商品分类树，</li>
</ul>
</li>
<li><code>&lt;v-flex xs9 class=&quot;px-1&quot;&gt;</code>：右侧：内部是规格参数展示</li>
</ul>
<h3 id="2-1-2-右侧规格"><a href="#2-1-2-右侧规格" class="headerlink" title="2.1.2.右侧规格"></a>2.1.2.右侧规格</h3><p>当我们点击一个分类时，最终要达到的效果：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1529550402376.png" alt="1529550402376"></p>
<p>可以看到右侧分为上下两部分：</p>
<ul>
<li>上部：面包屑，显示当前选中的分类</li>
<li>下部：table，显示规格参数信息</li>
</ul>
<p>页面实现：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1529550694218.png" alt="1529550694218"></p>
<p>可以看到右侧并不是我们熟悉的 <code>v-data-table</code>，而是一个<code>spec-group</code>组件（规格组）和<code>spec-param</code>组件（规格参数），这是我们定义的独立组件：</p>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1529550775415.png" alt="1529550775415"></p>
<p>在SpecGroup中定义了表格：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528427514717.png" alt="1528427514717"></p>
<h2 id="2-2-规格组的查询"><a href="#2-2-规格组的查询" class="headerlink" title="2.2.规格组的查询"></a>2.2.规格组的查询</h2><h3 id="2-2-1-树节点的点击事件"><a href="#2-2-1-树节点的点击事件" class="headerlink" title="2.2.1.树节点的点击事件"></a>2.2.1.树节点的点击事件</h3><p>当我们点击树节点时，要将<code>v-dialog</code>打开，因此必须绑定一个点击事件：（Specification.vue）</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528428028513.png" alt="1528428028513"></p>
<p>我们来看下<code>handleClick</code>方法：（Specification.vue）</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528428221957.png" alt="1528428221957"></p>
<p>点击事件发生时，发生了两件事：</p>
<ul>
<li>记录当前选中的节点，选中的就是商品分类</li>
<li><code>showGroup</code>被置为true，则规格组就会显示了。</li>
</ul>
<p>同时，我们把被选中的节点（商品分类）的id传递给了<code>SpecGroup</code>组件：（Specification.vue）</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528428308113.png" alt="1528428308113"></p>
<h3 id="2-2-2-页面查询规格组"><a href="#2-2-2-页面查询规格组" class="headerlink" title="2.2.2.页面查询规格组"></a>2.2.2.页面查询规格组</h3><p>来看下<code>SpecGroup.vue</code>中的实现：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528428617046.png" alt="1528428617046"></p>
<p>我们查看页面控制台，可以看到请求已经发出：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528428699027.png" alt="1528428699027"></p>
<h3 id="2-2-3-后端代码"><a href="#2-2-3-后端代码" class="headerlink" title="2.2.3.后端代码"></a>2.2.3.后端代码</h3><blockquote>
<p>实体类</p>
</blockquote>
<p>在<code>leyou-item-interface</code>中添加实体类：</p>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528429029149.png" alt="1528429029149"></p>
<p>内容：</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"tb_spec_group"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpecGroup</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> GenerationType<span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> Long cid<span class="token punctuation">;</span>

    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Transient</span>
    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>SpecParam<span class="token operator">></span> params<span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">// getter和setter省略</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"tb_spec_param"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpecParam</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> GenerationType<span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Long cid<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Long groupId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"`numeric`"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> Boolean numeric<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String unit<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Boolean generic<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Boolean searching<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String segments<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// getter和setter ...</span>
<span class="token punctuation">}</span></code></pre>
<p>在<code>leyou-item-service</code>中编写业务：</p>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528433648595.png" alt="1528433648595"></p>
<blockquote>
<p>mapper</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SpecGroupMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token operator">&lt;</span>SpecGroup<span class="token operator">></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span></code></pre>
<blockquote>
<p>controller</p>
</blockquote>
<p>先分析下需要的东西，在页面的ajax请求中可以看出：</p>
<ul>
<li><p>请求方式：get</p>
</li>
<li><p>请求路径：/spec/groups/{cid} ，这里通过路径占位符传递商品分类的id</p>
</li>
<li><p>请求参数：商品分类id</p>
</li>
<li><p>返回结果：页面是直接把<code>resp.data</code>赋值给了groups：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528429342796.png" alt="1528429342796"></p>
<p>那么我们返回的应该是规格组SpecGroup的集合</p>
</li>
</ul>
<p>代码：</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"spec"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpecificationController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> SpecificationService specificationService<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 根据分类id查询分组
     * @param cid
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"groups/{cid}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>SpecGroup<span class="token operator">>></span> <span class="token function">queryGroupsByCid</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"cid"</span><span class="token punctuation">)</span>Long cid<span class="token punctuation">)</span><span class="token punctuation">{</span>
        List<span class="token operator">&lt;</span>SpecGroup<span class="token operator">></span> groups <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>specificationService<span class="token punctuation">.</span><span class="token function">queryGroupsByCid</span><span class="token punctuation">(</span>cid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>CollectionUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>groups<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">notFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>groups<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<blockquote>
<p>service</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpecificationService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> SpecGroupMapper groupMapper<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 根据分类id查询分组
     * @param cid
     * @return
     */</span>
    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>SpecGroup<span class="token operator">></span> <span class="token function">queryGroupsByCid</span><span class="token punctuation">(</span>Long cid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        SpecGroup specGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpecGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        specGroup<span class="token punctuation">.</span><span class="token function">setCid</span><span class="token punctuation">(</span>cid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>groupMapper<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>specGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>页面访问测试：</p>
</blockquote>
<p>目前，我们数据库只为手机分类（76）提供了规格组：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528433697492.png" alt="1528433697492"></p>
<p>我们访问：<a href="http://api.leyou.com/api/item/spec/groups/76" target="_blank" rel="noopener">http://api.leyou.com/api/item/spec/groups/76</a></p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528433733340.png" alt="1528433733340"></p>
<p>然后在后台系统中测试：<br><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528433821121.png" alt="1528433821121"></p>
<h2 id="2-3-规格参数查询"><a href="#2-3-规格参数查询" class="headerlink" title="2.3.规格参数查询"></a>2.3.规格参数查询</h2><h3 id="2-3-1-表格切换"><a href="#2-3-1-表格切换" class="headerlink" title="2.3.1.表格切换"></a>2.3.1.表格切换</h3><p>当我们点击规格组，会切换到规格参数显示，肯定是在规格组中绑定了点击事件：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528429949504.png" alt="1528429949504"></p>
<p>我们看下事件处理：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528429988410.png" alt="1528429988410"></p>
<p>可以看到这里是使用了父子通信，子组件触发了select事件：</p>
<p>再来看下父组件的事件绑定：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528430052736.png" alt="1528430052736"></p>
<p>事件处理：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528430100166.png" alt="1528430100166"></p>
<p>这里我们记录了选中的分组，并且把标记设置为false，这样规格组就不显示了，而是显示：<code>SpecParam</code></p>
<p>并且，我们把group也传递到<code>spec-param</code>组件：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528430147829.png" alt="1528430147829"></p>
<h3 id="2-3-2-页面查询规格参数"><a href="#2-3-2-页面查询规格参数" class="headerlink" title="2.3.2.页面查询规格参数"></a>2.3.2.页面查询规格参数</h3><p>我们来看<code>SpecParam.vue</code>的实现：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528430319461.png" alt="1528430319461"></p>
<p>查看页面控制台，发现请求已经发出：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528430407298.png" alt="1528430407298"></p>
<p>报404，因为我们还没有实现后台逻辑，接下来就去实现。</p>
<h3 id="2-3-3-后台实现"><a href="#2-3-3-后台实现" class="headerlink" title="2.3.3.后台实现"></a>2.3.3.后台实现</h3><blockquote>
<p>SpecificationController</p>
</blockquote>
<p>分析：</p>
<ul>
<li>请求方式：GET</li>
<li>请求路径：/spec/params</li>
<li>请求参数：gid，分组id</li>
<li>返回结果：该分组下的规格参数集合<code>List&lt;SpecParam&gt;</code></li>
</ul>
<p>代码：</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
     * 根据条件查询规格参数
     * @param gid
     * @return
     */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"params"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>SpecParam<span class="token operator">>></span> <span class="token function">queryParams</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"gid"</span><span class="token punctuation">)</span>Long gid<span class="token punctuation">)</span><span class="token punctuation">{</span>
    List<span class="token operator">&lt;</span>SpecParam<span class="token operator">></span>  params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>specificationService<span class="token punctuation">.</span><span class="token function">queryParams</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>CollectionUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">notFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<blockquote>
<p>SpecificationService</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> SpecParamMapper paramMapper<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
     * 根据条件查询规格参数
     * @param gid
     * @return
     */</span>
<span class="token keyword">public</span> List<span class="token operator">&lt;</span>SpecParam<span class="token operator">></span> <span class="token function">queryParams</span><span class="token punctuation">(</span>Long gid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    SpecParam param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpecParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    param<span class="token punctuation">.</span><span class="token function">setGroupId</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paramMapper<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<blockquote>
<p>SpecParamMapper</p>
</blockquote>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1543383516456.png" alt="1543383516456"></p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SpecParamMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token operator">&lt;</span>SpecParam<span class="token operator">></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span></code></pre>
<p>测试：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528442972016.png" alt="1528442972016"></p>
<h2 id="2-4-增、删、改（作业）"><a href="#2-4-增、删、改（作业）" class="headerlink" title="2.4.增、删、改（作业）"></a>2.4.增、删、改（作业）</h2><p>增删改的作业就留给大家去完成了。页面中接口都已定义，你要做的就是实现后台接口。</p>
<h1 id="3-SPU和SKU数据结构"><a href="#3-SPU和SKU数据结构" class="headerlink" title="3.SPU和SKU数据结构"></a>3.SPU和SKU数据结构</h1><p>规格确定以后，就可以添加商品了,先看下数据库表</p>
<h2 id="3-1-SPU表"><a href="#3-1-SPU表" class="headerlink" title="3.1.SPU表"></a>3.1.SPU表</h2><p>SPU表：</p>
<pre class=" language-mysql"><code class="language-mysql">CREATE TABLE `tb_spu` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'spu id',
  `title` varchar(255) NOT NULL DEFAULT '' COMMENT '标题',
  `sub_title` varchar(255) DEFAULT '' COMMENT '子标题',
  `cid1` bigint(20) NOT NULL COMMENT '1级类目id',
  `cid2` bigint(20) NOT NULL COMMENT '2级类目id',
  `cid3` bigint(20) NOT NULL COMMENT '3级类目id',
  `brand_id` bigint(20) NOT NULL COMMENT '商品所属品牌id',
  `saleable` tinyint(1) NOT NULL DEFAULT '1' COMMENT '是否上架，0下架，1上架',
  `valid` tinyint(1) NOT NULL DEFAULT '1' COMMENT '是否有效，0已删除，1有效',
  `create_time` datetime DEFAULT NULL COMMENT '添加时间',
  `last_update_time` datetime DEFAULT NULL COMMENT '最后修改时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=208 DEFAULT CHARSET=utf8 COMMENT='spu表，该表描述的是一个抽象的商品，比如 iphone8';</code></pre>
<p>与我们前面分析的基本类似，但是似乎少了一些字段，比如商品描述。</p>
<p>我们做了表的垂直拆分，将SPU的详情放到了另一张表：tb_spu_detail</p>
<pre class=" language-mysql"><code class="language-mysql">CREATE TABLE `tb_spu_detail` (
  `spu_id` bigint(20) NOT NULL,
  `description` text COMMENT '商品描述信息',
  `generic_spec` varchar(10000) NOT NULL DEFAULT '' COMMENT '通用规格参数数据',
  `special_spec` varchar(1000) NOT NULL COMMENT '特有规格参数及可选值信息，json格式',
  `packing_list` varchar(3000) DEFAULT '' COMMENT '包装清单',
  `after_service` varchar(3000) DEFAULT '' COMMENT '售后服务',
  PRIMARY KEY (`spu_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</code></pre>
<p>这张表中的数据都比较大，为了不影响主表的查询效率我们拆分出这张表。</p>
<p>需要注意的是这两个字段：generic_spec和special_spec。</p>
<p>前面讲过规格参数与商品分类绑定，一个分类下的所有SPU具有类似的规格参数。SPU下的SKU可能会有不同的规格参数信息，因此我们计划是这样：</p>
<ul>
<li>SPUDetail中保存通用的规格参数信息。</li>
<li>SKU中保存特有规格参数。</li>
</ul>
<p>来看下我们的表如何存储这些信息。</p>
<h3 id="3-1-1-generic-spec字段"><a href="#3-1-1-generic-spec字段" class="headerlink" title="3.1.1.generic_spec字段"></a>3.1.1.generic_spec字段</h3><p>首先是<code>generic_spec</code>，其中保存通用规格参数信息的值，这里为了方便查询，使用了json格式：</p>
<blockquote>
<p>整体来看：</p>
</blockquote>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1529554390912.png" alt="1529554390912"></p>
<p>json结构，其中都是键值对：</p>
<ul>
<li>key：对应的规格参数的<code>spec_param</code>的id</li>
<li>value：对应规格参数的值</li>
</ul>
<h3 id="3-1-2-special-spec字段"><a href="#3-1-2-special-spec字段" class="headerlink" title="3.1.2.special_spec字段"></a>3.1.2.special_spec字段</h3><p>我们说spu中只保存通用规格参数，那么为什么有多出了一个<code>special_spec</code>字段呢？</p>
<p>以手机为例，品牌、操作系统等肯定是全局通用属性，内存、颜色等肯定是特有属性。</p>
<p>当你确定了一个SPU，比如小米的：红米4X</p>
<p>全局属性值都是固定的了：</p>
<pre><code>品牌：小米
型号：红米4X</code></pre><p>特有属性举例：</p>
<pre><code>颜色：[香槟金, 樱花粉, 磨砂黑]
内存：[2G, 3G]
机身存储：[16GB, 32GB]</code></pre><p>颜色、内存、机身存储，作为SKU特有属性，key虽然一样，但是SPU下的每一个SKU，其值都不一样，所以值会有很多，形成数组。</p>
<p>我们在SPU中，会把特有属性的所有值都记录下来，形成一个数组：</p>
<p>里面又有哪些内容呢？</p>
<p>来看数据格式：</p>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1529554916252.png" alt="1529554916252"></p>
<p>也是json结构：</p>
<ul>
<li>key：规格参数id</li>
<li>value：spu属性的数组</li>
</ul>
<p>那么问题来：特有规格参数应该在sku中记录才对，为什么在spu中也要记录一份？</p>
<p>因为我们有时候需要把所有规格参数都查询出来，而不是只查询1个sku的属性。比如，商品详情页展示可选的规格参数时：</p>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1526267828817.png" alt="1526267828817"></p>
<p>刚好符合我们的结构，这样页面渲染就非常方便了。</p>
<h2 id="3-2-SKU表"><a href="#3-2-SKU表" class="headerlink" title="3.2.SKU表"></a>3.2.SKU表</h2><pre class=" language-mysql"><code class="language-mysql">CREATE TABLE `tb_sku` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'sku id',
  `spu_id` bigint(20) NOT NULL COMMENT 'spu id',
  `title` varchar(255) NOT NULL COMMENT '商品标题',
  `images` varchar(1000) DEFAULT '' COMMENT '商品的图片，多个图片以‘,’分割',
  `price` bigint(15) NOT NULL DEFAULT '0' COMMENT '销售价格，单位为分',
  `indexes` varchar(100) COMMENT '特有规格属性在spu属性模板中的对应下标组合',
  `own_spec` varchar(1000) COMMENT 'sku的特有规格参数，json格式',
  `enable` tinyint(1) NOT NULL DEFAULT '1' COMMENT '是否有效，0无效，1有效',
  `create_time` datetime NOT NULL COMMENT '添加时间',
  `last_update_time` datetime NOT NULL COMMENT '最后修改时间',
  PRIMARY KEY (`id`),
  KEY `key_spu_id` (`spu_id`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='sku表,该表表示具体的商品实体,如黑色的64GB的iphone 8';</code></pre>
<p>还有一张表，代表库存：</p>
<pre class=" language-mysql"><code class="language-mysql">CREATE TABLE `tb_stock` (
  `sku_id` bigint(20) NOT NULL COMMENT '库存对应的商品sku id',
  `seckill_stock` int(9) DEFAULT '0' COMMENT '可秒杀库存',
  `seckill_total` int(9) DEFAULT '0' COMMENT '秒杀总数量',
  `stock` int(9) NOT NULL COMMENT '库存数量',
  PRIMARY KEY (`sku_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='库存表，代表库存，秒杀库存等信息';</code></pre>
<p>问题：为什么要将库存独立一张表？</p>
<p>因为库存字段写频率较高，而SKU的其它字段以读为主，因此我们将两张表分离，读写不会干扰。</p>
<p>特别需要注意的是sku表中的<code>indexes</code>字段和<code>own_spec</code>字段。sku中应该保存特有规格参数的值，就在这两个字段中。</p>
<h3 id="3-2-1-indexes字段"><a href="#3-2-1-indexes字段" class="headerlink" title="3.2.1.indexes字段"></a>3.2.1.indexes字段</h3><p>在SPU表中，已经对特有规格参数及可选项进行了保存，结构如下：</p>
<pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"4"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"香槟金"</span><span class="token punctuation">,</span>
        <span class="token string">"樱花粉"</span><span class="token punctuation">,</span>
        <span class="token string">"磨砂黑"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"12"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"2GB"</span><span class="token punctuation">,</span>
        <span class="token string">"3GB"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"13"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"16GB"</span><span class="token punctuation">,</span>
        <span class="token string">"32GB"</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>这些特有属性如果排列组合，会产生12个不同的SKU，而不同的SKU，其属性就是上面备选项中的一个。</p>
<p>比如：</p>
<ul>
<li>红米4X，香槟金，2GB内存，16GB存储</li>
<li>红米4X，磨砂黑，2GB内存，32GB存储</li>
</ul>
<p>你会发现，每一个属性值，对应于SPUoptions数组的一个选项，如果我们记录下角标，就是这样：</p>
<ul>
<li>红米4X，0,0,0</li>
<li>红米4X，2,0,1</li>
</ul>
<p>既然如此，我们是不是可以将不同角标串联起来，作为SPU下不同SKU的标示。这就是我们的indexes字段。</p>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1526266901335.png" alt="1526266901335"></p>
<p>这个设计在商品详情页会特别有用：</p>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1526267180997.png" alt="1526267180997"></p>
<p>当用户点击选中一个特有属性，你就能根据 角标快速定位到sku。</p>
<h3 id="3-2-2-own-spec字段"><a href="#3-2-2-own-spec字段" class="headerlink" title="3.2.2.own_spec字段"></a>3.2.2.own_spec字段</h3><p>看结构：</p>
<pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"4"</span><span class="token operator">:</span><span class="token string">"香槟金"</span><span class="token punctuation">,</span><span class="token property">"12"</span><span class="token operator">:</span><span class="token string">"2GB"</span><span class="token punctuation">,</span><span class="token property">"13"</span><span class="token operator">:</span><span class="token string">"16GB"</span><span class="token punctuation">}</span></code></pre>
<p>保存的是特有属性的键值对。</p>
<p>SPU中保存的是可选项，但不确定具体的值，而SKU中的保存的就是具体的值。</p>
<h2 id="3-3-导入图片信息"><a href="#3-3-导入图片信息" class="headerlink" title="3.3.导入图片信息"></a>3.3.导入图片信息</h2><p>现在商品表中虽然有数据，但是所有的图片信息都是无法访问的，我们需要把图片导入到虚拟机：</p>
<p>首先，把课前资料提供的数据上传到虚拟机下：<code>/leyou/static</code>目录：在leyou下创建static目录</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528445149890.png" alt="1528445149890"></p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528479229165.png" alt="1528479229165"></p>
<p>然后，使用命令解压缩：</p>
<pre class=" language-sh"><code class="language-sh">unzip images.zip</code></pre>
<p>修改Nginx配置，使nginx反向代理这些图片地址：</p>
<pre class=" language-sh"><code class="language-sh">vim /opt/nginx/config/nginx.conf</code></pre>
<p>修改成如下配置：</p>
<pre class=" language-nginx"><code class="language-nginx"><span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span>  image<span class="token punctuation">.</span>leyou<span class="token punctuation">.</span>com<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true"># 监听域名中带有group的，交给FastDFS模块处理</span>
    <span class="token keyword">location</span> <span class="token operator">~</span><span class="token operator">/</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span> <span class="token punctuation">{</span>
        ngx_fastdfs_module<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true"># 将其它图片代理指向本地的/leyou/static目录</span>
    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
        <span class="token keyword">root</span>   <span class="token operator">/</span>leyou<span class="token operator">/</span>static<span class="token operator">/</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  <span class="token operator">/</span>50x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token keyword">location</span> <span class="token operator">=</span> <span class="token operator">/</span>50x<span class="token punctuation">.</span>html <span class="token punctuation">{</span>
        <span class="token keyword">root</span>   html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<p>不要忘记重新加载nginx配置</p>
<pre><code>nginx -s reload</code></pre><h1 id="4-商品查询"><a href="#4-商品查询" class="headerlink" title="4.商品查询"></a>4.商品查询</h1><h2 id="4-1-效果预览"><a href="#4-1-效果预览" class="headerlink" title="4.1.效果预览"></a>4.1.效果预览</h2><p>接下来，我们实现商品管理的页面，先看下我们要实现的效果：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1526268595873.png" alt="1526268595873"></p>
<p>可以看出整体是一个table，然后有新增按钮。是不是跟昨天写品牌管理很像？</p>
<h2 id="4-2-页面请求"><a href="#4-2-页面请求" class="headerlink" title="4.2.页面请求"></a>4.2.页面请求</h2><p>先看整体页面结构（Goods.vue）：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528447301687.png" alt="1528447301687"></p>
<p>并且在Vue实例挂载后就会发起查询(mounted调用getDataFromServer方法初始化数据)：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528447431959.png" alt="1528447431959"></p>
<p>我们刷新页面，可以看到浏览器发起已经发起了查询商品数据的请求：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528447591939.png" alt="1528447591939"></p>
<p>因此接下来，我们编写接口即可。</p>
<h2 id="4-3-后台提供接口"><a href="#4-3-后台提供接口" class="headerlink" title="4.3.后台提供接口"></a>4.3.后台提供接口</h2><p>页面已经准备好，接下来在后台提供分页查询SPU的功能。</p>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1543414148030.png" alt="1543414148030"></p>
<p> <img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1543413983147.png" alt="1543413983147"></p>
<h3 id="4-3-1-实体类"><a href="#4-3-1-实体类" class="headerlink" title="4.3.1.实体类"></a>4.3.1.实体类</h3><p>在leyou-item-interface工程中添加实体类：</p>
<blockquote>
<p>SPU</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"tb_spu"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Spu</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> GenerationType<span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Long brandId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Long cid1<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 1级类目</span>
    <span class="token keyword">private</span> Long cid2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 2级类目</span>
    <span class="token keyword">private</span> Long cid3<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 3级类目</span>
    <span class="token keyword">private</span> String title<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 标题</span>
    <span class="token keyword">private</span> String subTitle<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 子标题</span>
    <span class="token keyword">private</span> Boolean saleable<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 是否上架</span>
    <span class="token keyword">private</span> Boolean valid<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 是否有效，逻辑删除用</span>
    <span class="token keyword">private</span> Date createTime<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 创建时间</span>
    <span class="token keyword">private</span> Date lastUpdateTime<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 最后修改时间</span>
    <span class="token comment" spellcheck="true">// 省略getter和setter</span>
<span class="token punctuation">}</span></code></pre>
<blockquote>
<p>SPU详情</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"tb_spu_detail"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpuDetail</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> Long spuId<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 对应的SPU的id</span>
    <span class="token keyword">private</span> String description<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 商品描述</span>
    <span class="token keyword">private</span> String specialSpec<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 商品特殊规格的名称及可选值模板</span>
    <span class="token keyword">private</span> String genericSpec<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 商品的全局规格属性</span>
    <span class="token keyword">private</span> String packingList<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 包装清单</span>
    <span class="token keyword">private</span> String afterService<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 售后服务</span>
    <span class="token comment" spellcheck="true">// 省略getter和setter</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="4-4-2-mapper"><a href="#4-4-2-mapper" class="headerlink" title="4.4.2.mapper"></a>4.4.2.mapper</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SpuMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token operator">&lt;</span>Spu<span class="token operator">></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="4-3-3-controller"><a href="#4-3-3-controller" class="headerlink" title="4.3.3.controller"></a>4.3.3.controller</h3><p>先分析：</p>
<ul>
<li><p>请求方式：GET</p>
</li>
<li><p>请求路径：/spu/page</p>
</li>
<li><p>请求参数：</p>
<ul>
<li>page：当前页</li>
<li>rows：每页大小</li>
<li>key：过滤条件</li>
<li>saleable：上架或下架</li>
</ul>
</li>
<li><p>返回结果：商品SPU的分页信息。</p>
<ul>
<li><p>要注意，页面展示的是商品分类和品牌名称，而数据库中保存的是id，怎么办？</p>
<p>我们可以新建一个类，继承SPU，并且拓展cname和bname属性，写到<code>leyou-item-interface</code></p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpuBo</span> <span class="token keyword">extends</span> <span class="token class-name">Spu</span> <span class="token punctuation">{</span>

    String cname<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 商品分类名称</span>

    String bname<span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 品牌名称</span>

    <span class="token comment" spellcheck="true">// 略 。。</span>
<span class="token punctuation">}</span></code></pre>
</li>
</ul>
</li>
</ul>
<p>编写controller代码：</p>
<p>我们把与商品相关的一切业务接口都放到一起，起名为GoodsController，业务层也是这样</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> GoodsService goodsService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"spu/page"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span>PageResult<span class="token operator">&lt;</span>SpuBo<span class="token operator">>></span> <span class="token function">querySpuBoByPage</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"key"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>String key<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"saleable"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>Boolean saleable<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"page"</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">)</span>Integer page<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"rows"</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">"5"</span><span class="token punctuation">)</span>Integer rows
    <span class="token punctuation">)</span><span class="token punctuation">{</span>
        PageResult<span class="token operator">&lt;</span>SpuBo<span class="token operator">></span> pageResult <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>goodsService<span class="token punctuation">.</span><span class="token function">querySpuBoByPage</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> saleable<span class="token punctuation">,</span> page<span class="token punctuation">,</span> rows<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CollectionUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>pageResult<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">notFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>pageResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<h3 id="4-4-4-service"><a href="#4-4-4-service" class="headerlink" title="4.4.4.service"></a>4.4.4.service</h3><p>所有商品相关的业务（包括SPU和SKU）放到一个业务下：GoodsService。</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> SpuMapper spuMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> CategoryService categoryService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> BrandMapper brandMapper<span class="token punctuation">;</span>

    <span class="token keyword">public</span> PageResult<span class="token operator">&lt;</span>SpuBo<span class="token operator">></span> <span class="token function">querySpuBoByPage</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> Boolean saleable<span class="token punctuation">,</span> Integer page<span class="token punctuation">,</span> Integer rows<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        Example example <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>Spu<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Example<span class="token punctuation">.</span>Criteria criteria <span class="token operator">=</span> example<span class="token punctuation">.</span><span class="token function">createCriteria</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 搜索条件</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            criteria<span class="token punctuation">.</span><span class="token function">andLike</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span> <span class="token string">"%"</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">"%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>saleable <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            criteria<span class="token punctuation">.</span><span class="token function">andEqualTo</span><span class="token punctuation">(</span><span class="token string">"saleable"</span><span class="token punctuation">,</span> saleable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// 分页条件</span>
        PageHelper<span class="token punctuation">.</span><span class="token function">startPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> rows<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 执行查询</span>
        List<span class="token operator">&lt;</span>Spu<span class="token operator">></span> spus <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>spuMapper<span class="token punctuation">.</span><span class="token function">selectByExample</span><span class="token punctuation">(</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>
        PageInfo<span class="token operator">&lt;</span>Spu<span class="token operator">></span> pageInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageInfo</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>spus<span class="token punctuation">)</span><span class="token punctuation">;</span>

        List<span class="token operator">&lt;</span>SpuBo<span class="token operator">></span> spuBos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        spus<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>spu<span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>
            SpuBo spuBo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpuBo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// copy共同属性的值到新的对象</span>
            BeanUtils<span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>spu<span class="token punctuation">,</span> spuBo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 查询分类名称</span>
            List<span class="token operator">&lt;</span>String<span class="token operator">></span> names <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>categoryService<span class="token punctuation">.</span><span class="token function">queryNamesByIds</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>spu<span class="token punctuation">.</span><span class="token function">getCid1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spu<span class="token punctuation">.</span><span class="token function">getCid2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spu<span class="token punctuation">.</span><span class="token function">getCid3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            spuBo<span class="token punctuation">.</span><span class="token function">setCname</span><span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// 查询品牌的名称</span>
            spuBo<span class="token punctuation">.</span><span class="token function">setBname</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>brandMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>spu<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            spuBos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>spuBo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PageResult</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>pageInfo<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spuBos<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="4-4-5-Category中拓展查询名称的功能"><a href="#4-4-5-Category中拓展查询名称的功能" class="headerlink" title="4.4.5.Category中拓展查询名称的功能"></a>4.4.5.Category中拓展查询名称的功能</h3><p>页面需要商品的分类名称需要在这里查询，因此要额外提供查询分类名称的功能，</p>
<p>在CategoryService中添加功能：</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> List<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token function">queryNamesByIds</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>Long<span class="token operator">></span> ids<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    List<span class="token operator">&lt;</span>Category<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>categoryMapper<span class="token punctuation">.</span><span class="token function">selectByIdList</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
    List<span class="token operator">&lt;</span>String<span class="token operator">></span> names <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>Category category <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        names<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>category<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> names<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// return list.stream().map(category -> category.getName()).collect(Collectors.toList());</span>
<span class="token punctuation">}</span></code></pre>
<p>mapper的selectByIdList方法是来自于通用mapper。不过需要我们在mapper上继承一个通用mapper接口：</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CategoryMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token operator">&lt;</span>Category<span class="token operator">></span><span class="token punctuation">,</span> SelectByIdListMapper<span class="token operator">&lt;</span>Category<span class="token punctuation">,</span> Long<span class="token operator">></span> <span class="token punctuation">{</span> 

<span class="token punctuation">}</span></code></pre>
<h2 id="4-5-测试"><a href="#4-5-测试" class="headerlink" title="4.5.测试"></a>4.5.测试</h2><p>刷新页面，查看效果：</p>
<p><img src="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/1528450054541.png" alt="1528450054541"></p>
<p>基本与预览的效果一致，OK！</p>

            </div>
            <hr/>

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            <div class="reprint">
                <p>
                    <span class="reprint-tip">
                        <i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;转载请注明:
                    </span>
                    <a href="http://chaining.coding.me" class="b-link-green">柴米油盐</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/chaining/2019/09/04/xiang-mu-shi-zhan/le-you-shang-cheng/day09-shang-pin-gui-ge-guan-li/" class="b-link-green">day09-商品规格管理</a>
                </p>
            </div>
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: 'bee4fd2b7760acfaf98d',
        clientSecret: '4ebf2c41dd6701ef493eee655aa1a9a31108b868',
        repo: 'chainingning.github.io',
        owner: 'chainingning',
        admin: ["chainingning"],
        id: '2019-09-04T10-33-23',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/chaining/2019/09/06/xiang-mu-shi-zhan/le-you-shang-cheng/day10-shang-pin-guan-li/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/2.jpg" class="responsive-img" alt="day10-商品管理">
                        
                        <span class="card-title">day10-商品管理</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">0.学习目标
独立实现商品新增后台
独立实现商品编辑后台
独立搭建前台系统页面

1.商品新增当我们点击新增商品按钮：

就会出现一个弹窗：

里面把商品的数据分为了4部分来填写：

基本信息：主要是一些简单的文本数据，包含了SPU和Spu</div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2019-09-06
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/chaining/categories/项目实战/" class="post-category" target="_blank">
                                    项目实战
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/chaining/tags/SpringBoot/" target="_blank">
                        <span class="chip bg-color">SpringBoot</span>
                    </a>
                    
                    <a href="/chaining/tags/项目实战/" target="_blank">
                        <span class="chip bg-color">项目实战</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/chaining/2019/09/03/xiang-mu-shi-zhan/le-you-shang-cheng/day08-pin-pai-guan-li/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/17.jpg" class="responsive-img" alt="day08-品牌管理">
                        
                        <span class="card-title">day08-品牌管理</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">0.学习目标
独立实现品牌新增
实现图片上传
了解FastDFS的安装
使用FastDFS客户端实现上传

1.品牌的新增昨天我们完成了品牌的查询，接下来就是新增功能。点击新增品牌按钮

Brand.vue页面有一个提交按钮：

点击触发a</div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2019-09-03
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/chaining/categories/项目实战/" class="post-category" target="_blank">
                                    项目实战
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/chaining/tags/SpringBoot/" target="_blank">
                        <span class="chip bg-color">SpringBoot</span>
                    </a>
                    
                    <a href="/chaining/tags/项目实战/" target="_blank">
                        <span class="chip bg-color">项目实战</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 柴米油盐<br />'
            + '作者: Chester<br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>

    </div>
    <div class="col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });
    });
</script>
    

</main>


<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            本站由&copy;<a href="https://chainingning.github.io/" target="_blank">Chester</a>基于
            <a href="https://hexo.io/" target="_blank">Hexo</a>搭建.

            
                &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
                <span class="white-color">347.3k</span>
            

            
			
                <br>
                
                <span id="busuanzi_container_site_pv">
                    <i class="fa fa-heart-o"></i>
                    本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
                </span>
                
                
                <span id="busuanzi_container_site_uv">
                    <i class="fa fa-users"></i>
                    次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
                </span>
                
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/chainingning" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:ning.chai@foxmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=88905457" class="tooltipped" data-tooltip="QQ联系我: 88905457" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>



    <a href="/chaining/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/chaining/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<script src="/js/matery.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->




    <script async src="/libs/others/busuanzi.pure.mini.js"></script>


</body>
</html>